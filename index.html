<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Time Traveler Puzzle</title>
<style>
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    font-family: Arial, sans-serif;
    background-color: #222;
    color: #fff;
    height: 100vh;
    overflow-x: hidden;
  }

  #discussion {
    background-color: #333;
    padding: 15px;
    border: 2px solid #fff;
    border-radius: 8px;
    margin: 10px;
    max-width: 90%;
  }

  #discussion h2 {
    margin-top: 0;
    cursor: pointer;
  }

  #discussion p {
    margin: 5px 0;
  }

  #gameCanvas {
    background-color: #333;
    margin-top: 10px;
    border: 2px solid #fff;
  }

  #controls {
    display: flex;
    justify-content: center;
    margin-top: 10px;
    flex-wrap: wrap;
  }

  .btn {
    background-color: #555;
    border: none;
    color: white;
    padding: 15px;
    margin: 5px;
    font-size: 18px;
    border-radius: 5px;
    user-select: none;
  }

  .btn:active {
    background-color: #777;
  }

  #level-info {
    margin-top: 10px;
    font-size: 20px;
  }
</style>
</head>
<body>

<div id="discussion">
  <h2 onclick="toggleDiscussion()">How to Play üïπÔ∏è (Click to Toggle)</h2>
  <div id="discussion-content">
    <p>Welcome to <strong>Time Traveler Puzzle</strong>! Your goal is to reach the exit tile without colliding with your past selves.</p>
    <p><strong>Controls:</strong></p>
    <ul>
      <li>Use the <strong>arrow keys</strong> on desktop to move.</li>
      <li>On mobile, use the <strong>buttons below the grid</strong> to move.</li>
    </ul>
    <p><strong>Rules:</strong></p>
    <ul>
      <li>You start at the top-left corner and must reach the exit (gold tile).</li>
      <li>Each level, your previous moves become <strong>time clones</strong> that replay automatically.</li>
      <li>Colliding with a clone will restart the level.</li>
      <li>Each new level adds a clone from the previous level, making it more challenging!</li>
    </ul>
    <p><strong>Strategy:</strong></p>
    <ul>
      <li>Plan your moves carefully to avoid past selves.</li>
      <li>Think ahead: where you go now will become a clone in the next level!</li>
      <li>Levels get harder as more clones appear, so patience and observation are key.</li>
    </ul>
    <p>Enjoy the challenge and become a master time traveler!</p>
  </div>
</div>

<div id="level-info">Level: 1</div>
<canvas id="gameCanvas"></canvas>
<div id="controls">
  <button class="btn" onclick="movePlayer(0,-1)">‚Üë</button>
  <button class="btn" onclick="movePlayer(-1,0)">‚Üê</button>
  <button class="btn" onclick="movePlayer(1,0)">‚Üí</button>
  <button class="btn" onclick="movePlayer(0,1)">‚Üì</button>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let gridSize = 8;
let tileSize;
let levels = 5;
let currentLevel = 1;

// Player & clone structures
let player = {x:0, y:0, moves:[]};
let clones = [];
let exit = {x:gridSize-1, y:gridSize-1};

// Resize canvas for mobile
function resizeCanvas(){
    let size = Math.min(window.innerWidth, window.innerHeight) * 0.8;
    canvas.width = size;
    canvas.height = size;
    tileSize = canvas.width / gridSize;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// Toggle discussion visibility
function toggleDiscussion(){
    const content = document.getElementById('discussion-content');
    if(content.style.display === 'none') content.style.display = 'block';
    else content.style.display = 'none';
}

// Start or reset level
function startLevel(level){
    currentLevel = level;
    document.getElementById('level-info').innerText = "Level: " + level;
    player.x = 0; player.y = 0; player.moves = [];
    clones = [];
    exit.x = gridSize-1; exit.y = gridSize-1;

    // Load clones from previous levels
    for(let l=1; l<level; l++){
        clones.push({moves: [...levelMoves[l-1]], x:0, y:0, step:0});
    }
    draw();
}

// Store all player moves per level
let levelMoves = [];

// Movement function
function movePlayer(dx, dy){
    let newX = player.x + dx;
    let newY = player.y + dy;
    if(newX>=0 && newX<gridSize && newY>=0 && newY<gridSize){
        player.x = newX;
        player.y = newY;
        player.moves.push({x:newX, y:newY});
        updateClones();
        draw();
        checkExit();
    }
}

// Update clone positions
function updateClones(){
    clones.forEach(c=>{
        if(c.step < c.moves.length){
            c.x = c.moves[c.step].x;
            c.y = c.moves[c.step].y;
            c.step++;
        }
    });
}

// Check collisions & exit
function checkExit(){
    // Clone collision
    for(let c of clones){
        if(c.x === player.x && c.y === player.y){
            alert("Hit your past self! Restarting level.");
            startLevel(currentLevel);
            return;
        }
    }
    // Reached exit
    if(player.x === exit.x && player.y === exit.y){
        levelMoves[currentLevel-1] = [...player.moves];
        if(currentLevel < levels){
            alert("Level Complete! Next Level");
            startLevel(currentLevel+1);
        } else {
            alert("Congratulations! You finished all levels.");
            startLevel(1);
        }
    }
}

// Draw everything
function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // Draw grid
    ctx.strokeStyle = '#555';
    for(let i=0;i<=gridSize;i++){
        ctx.beginPath();
        ctx.moveTo(i*tileSize,0);
        ctx.lineTo(i*tileSize,canvas.height);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(0,i*tileSize);
        ctx.lineTo(canvas.width,i*tileSize);
        ctx.stroke();
    }
    // Draw exit
    ctx.fillStyle = 'gold';
    ctx.fillRect(exit.x*tileSize, exit.y*tileSize, tileSize, tileSize);
    // Draw clones
    clones.forEach(c=>{
        ctx.fillStyle = 'rgba(0,150,255,0.5)';
        ctx.fillRect(c.x*tileSize, c.y*tileSize, tileSize, tileSize);
    });
    // Draw player
    ctx.fillStyle = 'lime';
    ctx.fillRect(player.x*tileSize, player.y*tileSize, tileSize, tileSize);
}

// Keyboard controls
window.addEventListener('keydown', e=>{
    if(e.key==='ArrowUp') movePlayer(0,-1);
    else if(e.key==='ArrowDown') movePlayer(0,1);
    else if(e.key==='ArrowLeft') movePlayer(-1,0);
    else if(e.key==='ArrowRight') movePlayer(1,0);
});

// Start first level
startLevel(1);
</script>
</body>
</html>
